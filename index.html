<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>דשבורד פעילות ותוכניות</title>

<style>
:root{
  --bg-main:#f8fafc;--bg-surface:#eef2f7;--card-bg:#ffffff;--accent:#2563eb;--accent-soft:#e0ecff;--text-main:#0f172a;--text-muted:#475569;--border:#e2e8f0;
}
body{margin:0;font-family:Assistant,system-ui,sans-serif;background:linear-gradient(180deg,var(--bg-main),var(--bg-surface));color:var(--text-main);} 
header{background:#fff;border-bottom:1px solid var(--border);} 
.header-inner{max-width:1200px;margin:auto;padding:14px;display:flex;gap:16px;align-items:center;} 
.app-logo{height:42px;} 
.controls,.nav-controls{display:flex;justify-content:center;gap:8px;margin:10px auto;flex-wrap:wrap;} 
select,button{height:32px;font-size:13px;padding:4px 10px;border-radius:8px;border:1px solid var(--border);background:#fff;box-shadow:0 2px 4px rgba(0,0,0,.08);} 
#todayBtn{display:none;} 
button.active{background:var(--accent);color:#fff;}
.nav-btn{width:32px;height:32px;border-radius:999px;} 
.nav-controls{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--border);padding:6px 0;}
.calendar-grid{max-width:1200px;margin:auto;padding:10px;display:grid;grid-template-columns:repeat(6,1fr);gap:12px;} 
.day{background:var(--card-bg);border-radius:14px;padding:10px;box-shadow:0 6px 16px rgba(0,0,0,.1);} 
.day.inactive{opacity:.25} 
.day-header{font-weight:700;margin-bottom:6px;display:flex;justify-content:space-between;align-items:center;} 
.badge{background:var(--accent);color:#fff;border-radius:999px;padding:0 6px;font-size:11px;}
.event{background:linear-gradient(135deg,var(--accent-soft),#fff);border-radius:10px;padding:8px;margin-top:6px;font-size:13px;}
.event.holiday{font-weight:900;font-size:16px;background:linear-gradient(135deg,#fde68a,#fff7ed);} 
.meta{font-size:12px;color:var(--text-muted);} 
.calendar-grid>.meta{font-size:36px;font-weight:900;text-align:center;color:#0f172a;} 
</style>
</head>
<body>
<header>
  <div class="header-inner">
    <img src="logo.png" class="app-logo" alt="logo">
    <div><strong>דשבורד פעילות ותוכניות</strong><br><span class="meta">תצוגה חודשית / שבועית לפי תאריכים</span></div>
  </div>
</header>

<div class="controls">
  <select id="managerFilter"><option value="">סינון לפי מנהל</option></select>
  <select id="programFilter"><option value="">סינון לפי תוכנית</option></select>
  <select id="employeeFilter"><option value="">בחר עובד</option></select>
  <button id="clearFilters">נקה סינון</button>
</div>

<div class="nav-controls" id="navControls">
  <div class="nav-main">
    <button id="viewMonthBtn" class="active">חודש</button>
    <button id="viewWeekBtn">שבוע</button>
    <button id="prevNav" class="nav-btn">▶</button>
    <span id="navTitle"></span>
    <button id="nextNav" class="nav-btn">◀</button>
  </div>
</div>

<div id="calendarGrid" class="calendar-grid"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
let rawData=[],currentDate=new Date();currentDate.setHours(0,0,0,0);
let currentMode='month',activeWeeks=[],activeWeekIndex=0;
const dayNames=['א','ב','ג','ד','ה','ו'];

const HOLIDAYS={
 '2026-03-03':'פורים','2026-03-04':'פורים','2026-03-24':'פסח','2026-03-25':'פסח','2026-03-26':'פסח','2026-03-27':'פסח','2026-03-28':'פסח','2026-03-29':'פסח','2026-03-30':'פסח','2026-03-31':'פסח','2026-04-01':'פסח','2026-04-02':'פסח','2026-04-03':'פסח','2026-04-04':'פסח','2026-04-05':'פסח','2026-04-06':'פסח','2026-04-07':'פסח','2026-04-08':'פסח','2026-04-20':'ערב יום הזיכרון','2026-04-21':'יום הזיכרון','2026-04-22':'יום העצמאות','2026-05-08':'ל"ג בעומר','2026-05-21':'שבועות','2026-05-22':'שבועות'
};
function ymd(d){return d.toISOString().slice(0,10);} 
function isHoliday(d){return !!HOLIDAYS[ymd(d)];}
function holidayName(d){return HOLIDAYS[ymd(d)]||'';}
function sameDay(a,b){return a&&b&&a.getTime()===b.getTime();}
function startOfWeek(d){const x=new Date(d);x.setDate(x.getDate()-x.getDay());x.setHours(0,0,0,0);return x;}
function parseDateSafe(v){if(!v)return null;if(typeof v==='number'){const d=new Date(Math.round((v-25569)*86400*1000));d.setHours(0,0,0,0);return d;}const d=new Date(v);if(!isNaN(d)){d.setHours(0,0,0,0);return d;}return null;}

async function loadExcel(){
 const r=await fetch('DASHBOARD.xlsx',{cache:'no-store'});
 const b=await r.arrayBuffer();
 const wb=XLSX.read(b,{type:'array'});
 const sh=wb.Sheets[wb.SheetNames[0]];
 const rows=XLSX.utils.sheet_to_json(sh,{header:1,defval:''});
 rawData=rows.slice(1).map(row=>({Dates:row.slice(7,23).map(parseDateSafe)}));
 render();
}

function render(){
 calendarGrid.innerHTML='';
 const y=currentDate.getFullYear(),m=currentDate.getMonth();
 navTitle.textContent=currentDate.toLocaleString('he-IL',{month:'long',year:'numeric'});
 dayNames.forEach(d=>calendarGrid.appendChild(Object.assign(document.createElement('div'),{className:'meta',textContent:d})));
 for(let day=1;day<=31;day++){
   const d=new Date(y,m,day);
   if(d.getMonth()!==m||d.getDay()===6) continue;
   const cell=document.createElement('div');cell.className='day';
   const h=document.createElement('div');h.className='day-header';h.textContent=day;cell.appendChild(h);
   if(isHoliday(d)){
     const ev=document.createElement('div');
     ev.className='event holiday';
     ev.innerHTML = `<strong>${holidayName(d)}</strong>`;
     cell.appendChild(ev);
   }
   calendarGrid.appendChild(cell);
 }
}

prevNav.onclick=()=>{currentDate.setMonth(currentDate.getMonth()-1);render();};
nextNav.onclick=()=>{currentDate.setMonth(currentDate.getMonth()+1);render();};
viewMonthBtn.onclick=()=>{currentMode='month';render();};
viewWeekBtn.onclick=()=>{currentMode='week';render();};
loadExcel();
</script>
</body>
</html>
